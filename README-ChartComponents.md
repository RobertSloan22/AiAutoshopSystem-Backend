# Chart Display Components for Frontend Integration

This package provides drop-in React components for displaying charts generated by your backend API in a chat interface.

## Components Overview

### 1. `ChartDisplay.jsx`
A standalone component for displaying chart visualizations with support for:
- Grid layout for multiple charts
- Click-to-expand functionality 
- Modal view for detailed chart inspection
- Loading states and error handling
- Responsive design

### 2. `ChatWithCharts.jsx`
A complete chat interface that integrates chart generation with conversation:
- Real-time streaming of AI responses
- Automatic chart display when generated
- Chat history with embedded charts
- Vehicle/customer context support
- Loading and error states

### 3. `useChartStream.js`
A custom React hook for managing chart generation via your API:
- Server-sent events (SSE) streaming support
- State management for visualizations
- Error handling and recovery
- Stream lifecycle management

## Quick Integration

### Basic Chart Display
```jsx
import ChartDisplay from './components/ChartDisplay';

function MyComponent() {
  const [charts, setCharts] = useState([]);
  
  return (
    <ChartDisplay 
      visualizations={charts}
      isLoading={false}
      error={null}
    />
  );
}
```

### Full Chat Interface
```jsx
import ChatWithCharts from './components/ChatWithCharts';

function App() {
  const vehicleContext = {
    make: "Toyota",
    model: "Camry", 
    year: 2020
  };

  return (
    <ChatWithCharts 
      vehicleContext={vehicleContext}
      apiBaseUrl="/api"
      placeholder="Ask me to analyze vehicle data..."
    />
  );
}
```

### Using the Hook Directly
```jsx
import { useChartStream } from './hooks/useChartStream';

function CustomChatComponent() {
  const {
    visualizations,
    isGenerating,
    generateChartFromMessage,
    clearCharts
  } = useChartStream('/api');

  const handleAnalyze = async () => {
    await generateChartFromMessage("Show me engine temperature trends");
  };

  return (
    <div>
      <button onClick={handleAnalyze} disabled={isGenerating}>
        Generate Chart
      </button>
      {visualizations.length > 0 && (
        <ChartDisplay visualizations={visualizations} />
      )}
    </div>
  );
}
```

## API Integration

The components work with your existing backend endpoints:

### Streaming Analysis Endpoint
- **POST** `/api/chat/analyze/stream`
- Expects: `{ question, vehicleContext?, customerContext? }`
- Returns: Server-sent events stream with chart data

### Non-streaming Analysis Endpoint  
- **POST** `/api/chat/analyze`
- Same request format, returns JSON response with charts

## Expected Data Format

Your API should return visualization data in this format:

```json
{
  "visualizations": [
    {
      "imageId": "unique-id",
      "url": "http://example.com/chart.png",
      "data": "base64-encoded-image-data",
      "path": "/path/to/chart.png"
    }
  ]
}
```

## Styling

Each component includes its own CSS file:
- `ChartDisplay.css` - Chart visualization styles
- `ChatWithCharts.css` - Chat interface styles

The styles are self-contained and use CSS custom properties for easy theming.

## Features

### ChartDisplay Component
- **Grid Layout**: Automatically arranges multiple charts
- **Expandable**: Click any chart to view in detail
- **Modal View**: Full-screen chart inspection
- **Responsive**: Adapts to different screen sizes
- **Loading States**: Shows spinners during generation
- **Error Handling**: Displays error messages gracefully

### ChatWithCharts Component
- **Real-time Streaming**: Shows AI responses as they generate
- **Chart Integration**: Automatically displays charts in conversation
- **Context Aware**: Supports vehicle and customer context
- **History**: Maintains chat history with embedded charts
- **Controls**: Stop generation, clear chat, etc.

### useChartStream Hook
- **Stream Management**: Handles SSE connections automatically
- **State Tracking**: Manages loading, error, and completion states
- **Cleanup**: Properly closes connections on unmount
- **Error Recovery**: Handles network issues gracefully

## Customization

### Theming
Modify the CSS custom properties to match your brand:

```css
:root {
  --chart-primary-color: #667eea;
  --chart-success-color: #38a169;
  --chart-error-color: #e53e3e;
  --chart-background: #f8f9fa;
}
```

### Event Handlers
Pass custom handlers to extend functionality:

```jsx
<ChartDisplay 
  visualizations={charts}
  onChartClick={(chart, index) => {
    // Custom chart interaction
    console.log('Chart clicked:', chart);
  }}
/>

<ChatWithCharts 
  onMessageSent={(message) => {
    // Track user interactions
    analytics.track('chart_request', { message });
  }}
/>
```

## Dependencies

Required peer dependencies:
- React 16.8+ (for hooks)
- Modern browser with EventSource support

No additional libraries required - uses native browser APIs for streaming.

## Browser Support

- **Modern Browsers**: Full support
- **IE11**: Limited support (no EventSource)
- **Mobile**: Responsive design included

## Performance

- **Lazy Loading**: Charts load as they're generated
- **Memory Management**: Automatic cleanup of resources
- **Optimized Rendering**: Minimal re-renders during streaming
- **Image Optimization**: Supports both base64 and URL sources